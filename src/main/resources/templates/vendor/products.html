<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Products - ShopFlow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(3px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: #fff;
            padding: 24px;
            border-radius: 14px;
            width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            animation: fadeIn 0.2s ease-in-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 14px;
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-two-columns {
            display: flex;
            gap: 12px;
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background: #6c3ef0;
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: #5833c9;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        * { box-sizing: border-box; }
        body { margin:0; font-family:'Inter',sans-serif; background:#f9f9fb; color:#222; min-height:100vh; display:flex; flex-direction:column; }
        header { background:#fff; padding:16px 48px; box-shadow:0 1px 3px rgba(0,0,0,.05); display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:10; }
        .logo { font-weight:700; font-size:20px; color:#222; text-decoration:none; }
        .nav-links { display:flex; gap:24px; align-items:center; }
        .nav-links a { text-decoration:none; color:#555; font-weight:500; font-size:14px; transition:color .2s; }
        .nav-links a:hover { color:#6c3ef0; }
        .nav-links a.active { color:#6c3ef0; font-weight:600; position:relative; }
        .nav-links a.active::after { content:''; position:absolute; bottom:-8px; left:0; width:100%; height:2px; background:#6c3ef0; border-radius:1px; }
        .badge { background:#6c3ef0; color:#fff; padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; }
        main { flex-grow:1; padding:32px 48px; }
        .page-title { font-size:24px; font-weight:700; margin-bottom:24px; color:#222; display:flex; justify-content:space-between; align-items:center; }
        .stats { display:flex; gap:16px; margin-bottom:24px; }
        .stat-card { background:#fff; padding:16px 20px; border-radius:12px; box-shadow:0 1px 6px rgba(0,0,0,.05); font-size:14px; }
        .stat-card strong { color:#6c3ef0; }
        .search-bar { display:flex; gap:12px; margin-bottom:24px; }
        .search-input { flex:1; padding:10px 16px; border:1px solid #ddd; border-radius:8px; font-size:14px; }
        .search-btn { padding:10px 20px; background:#6c3ef0; color:#fff; border:none; border-radius:8px; font-weight:600; cursor:pointer; }
        .search-btn:hover { background:#5833c9; }
        .table-container { background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 2px 12px rgba(0,0,0,.05); }
        table { width:100%; border-collapse:collapse; }
        th { background:#f8f9ff; padding:16px; text-align:left; font-weight:600; font-size:14px; color:#444; border-bottom:1px solid #eee; }
        td { padding:16px; font-size:14px; color:#333; border-bottom:1px solid #eee; }
        tr:hover { background-color:#f8f9ff; }
        .product-name { font-weight:600; color:#222; }
        .sold-badge { background:#dcfce7; color:#166534; padding:4px 8px; border-radius:6px; font-size:12px; font-weight:600; }
        .stock-low { color:#ef4444; font-weight:600; }
        .actions { display:flex; gap:8px; }
        .btn { padding:6px 12px; border:none; border-radius:6px; font-size:13px; font-weight:600; cursor:pointer; }
        .btn-edit { background:#e0e7ff; color:#6c3ef0; }
        .btn-edit:hover { background:#c7d2fe; }
        .pagination { display:flex; justify-content:center; gap:8px; margin-top:24px; }
        .page-btn { padding:8px 12px; background:#f1f5f9; color:#475569; border-radius:6px; font-size:14px; cursor:pointer; }
        .page-btn.active { background:#6c3ef0; color:#fff; }
        .page-btn:disabled { opacity:0.5; cursor:not-allowed; }
        .lang-toggle { background:none; border:none; cursor:pointer; font-size:14px; color:#6c3ef0; }
        @media (max-width:768px) {
            header { padding:16px; flex-direction:column; gap:12px; }
            main { padding:20px; }
            .search-bar { flex-direction:column; }
            .stats { flex-direction:column; }
            .table-container { overflow-x:auto; }
            table { min-width:800px; }
        }
    </style>
</head>
<body>

<div th:replace="fragments/headerVendor :: VendorHeader(${currentWebPage})"></div>

<main>
    <div class="page-title">
        <div>My Products</div>
        <div>
            <span th:text="${#lists.size(products)}">24</span> <strong>Products</strong>

            <button onclick="openModal()"
                    style="padding:8px 14px; background:#6c3ef0; color:#fff; border:none; border-radius:8px; font-size:14px; margin-left:12px; cursor:pointer;">
                + Add Product
            </button>

        </div>
    </div>

    <!-- Stats -->
    <div class="stats">
        <div class="stat-card">
            <div>Total Sold</div>
            <strong th:text="${totalSold}">1,842</strong>
        </div>
        <div class="stat-card">
            <div>Revenue</div>
            <strong th:text="'$' + ${totalRevenue}">12,450</strong>
        </div>
        <div class="stat-card">
            <div>Low Stock</div>
            <strong th:text="${lowStockCount}">3</strong>
        </div>
    </div>

    <!-- Search -->
    <div class="search-bar">
        <input type="text" class="search-input" placeholder="Search by product name..." id="searchInput">
        <button class="search-btn" onclick="filterProducts()">Search</button>
    </div>

    <!-- Products Table (Sorted by soldQuantity DESC) -->
    <div class="table-container" th:if="${products != null and !products.isEmpty()}">
        <table>
            <thead>
            <tr>
                <th>Rank</th>
                <th>Product</th>
                <th>Category</th>
                <th>Price</th>
                <th>OldPrice</th>
                <th>Stock</th>
                <th>Sold</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product, iter : ${products}" th:data-product-id="${product.id}">
                <td>
                    <span th:text="${iter.index + 1}" class="sold-badge"
                          th:if="${iter.index == 0}">1st</span>
                    <span th:text="${iter.index + 1}" th:unless="${iter.index == 0}"></span>
                </td>
                <td>
                    <div class="product-name" th:text="${product.name}">iPhone 15 Pro</div>
                </td>
                <td th:text="${product.subSubCategoryDto?.name}">Smartphones</td>
                <td th:text="${product.price} + 'sum'">999.00</td>
                <td th:if="${product.oldPrice != null}" th:text="${product.oldPrice} + ' sum'">999.00</td>
                <td th:unless="${product.oldPrice != null}" colspan="1" style="color: #9ca3af; font-style: italic;">-</td>
                <td>
                    <span th:text="${product.stockQuantity}"
                          th:classappend="${product.stockQuantity <= 10} ? 'stock-low'"></span>
                </td>
                <td>
                    <strong th:text="${product.soldQuantity}">124</strong>
                </td>
                <td class="actions">
                    <button class="btn btn-edit" onclick="openEditModal(this)"
                            th:attr="data-id=${product.id},
                     data-name=${product.name},
                     data-price=${product.price},
                     data-stock=${product.stockQuantity},
                     data-image=${product.imageProducts != null && !product.imageProducts.isEmpty() ? product.imageProducts[0].path : '/images/placeholder.jpg'},
                     data-category=${product.subSubCategoryDto?.name}">
                        Edit
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Empty State -->
    <div class="empty-state" th:if="${products == null or products.isEmpty()}"
         style="text-align:center; padding:48px 20px; color:#666;">
        <img src="https://cdn-icons-png.flaticon.com/512/7486/7486760.png" alt="No products" style="width:80px; opacity:.3; margin-bottom:16px;">
        <p>No products yet.</p>
        <a th:href="@{/vendor/product/add}" class="btn btn-primary" style="display:inline-block; margin-top:12px;">Add Product</a>
    </div>

    <!-- Pagination -->
    <div class="pagination" th:if="${totalPages > 1}">
        <button class="page-btn" th:disabled="${currentPage == 0}"
                th:onclick="|location.href='@{/vendor/products(page=${currentPage - 1})}'|">Previous</button>
        <button class="page-btn" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'"
                th:onclick="|location.href='@{/vendor/products(page=${i})}'|"
                th:text="${i + 1}">1</button>
        <button class="page-btn" th:disabled="${currentPage == totalPages - 1}"
                th:onclick="|location.href='@{/vendor/products(page=${currentPage + 1})}'|">Next</button>
    </div>
</main>

<!-- ðŸ”¥ EDIT PRODUCT MODAL -->
<div id="editProductModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div class="modal" style="background:#fff; border-radius:16px; width:90%; max-width:500px; max-height:90vh; overflow-y:auto; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
        <div class="modal-header" style="padding:20px 24px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0; font-size:22px; font-weight:700;">Edit Product</h2>
            <button type="button" class="close-btn" onclick="closeEditModal()" style="background:none; border:none; font-size:28px; cursor:pointer; color:#999;">Ã—</button>
        </div>

        <form id="editProductForm" method="post">
            <div style="padding:24px;">
                <!-- HIDDEN PRODUCT ID -->
                <input type="hidden" name="id" id="editProductId" required>

                <!-- CURRENT PRODUCT INFO (Read-only) -->
                <div style="background:#f8fafc; padding:16px; border-radius:12px; margin-bottom:20px; border:1px solid #e2e8f0;">
                    <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
                        <div style="width:60px; height:60px; background:#e2e8f0; border-radius:8px; overflow:hidden;">
                            <img id="editProductImage" style="width:100%; height:100%; object-fit:cover;" src="" alt="Product">
                        </div>
                        <div>
                            <div id="editProductName" style="font-weight:700; color:#1e293b; font-size:16px;"></div>
                            <div id="editProductCategory" style="font-size:14px; color:#64748b;"></div>
                        </div>
                    </div>
                    <div id="editProductCurrentStock" style="font-size:14px; color:#64748b;"></div>
                </div>

                <!-- PRICE -->
                <div class="form-group" style="margin-bottom:16px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">New Price (so'm)</label>
                    <input type="number" name="price" id="editPrice" step="0.01" min="0.01" required placeholder="99.99"
                           style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                    <small style="color:#64748b;">Current price will be replaced</small>
                </div>

                <!-- STOCK -->
                <div class="form-group" style="margin-bottom:20px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Add Stock Quantity</label>
                    <input type="number" name="stockQuantity" id="editStockQuantity" min="0" required placeholder="0"
                           style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                    <small style="color:#64748b;">Enter how many items to ADD (0 = no change)</small>
                </div>

                <div style="display:flex; gap:12px; justify-content:flex-end;">
                    <button type="button" onclick="closeEditModal()"
                            style="padding:12px 24px; background:#f1f5f9; border:none; border-radius:8px; cursor:pointer; font-weight:600;">
                        Cancel
                    </button>
                    <button type="submit" id="editSubmitBtn"
                            style="padding:12px 32px; background:#6c3ef0; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600;">
                        Update Product
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Add Product Modal -->
<div id="addProductModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div class="modal" style="background:#fff; border-radius:16px; width:90%; max-width:600px; max-height:90vh; overflow-y:auto; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
        <div class="modal-header" style="padding:20px 24px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0; font-size:22px; font-weight:700;">Add New Product</h2>
            <button type="button" class="close-btn" onclick="closeModal()" style="background:none; border:none; font-size:28px; cursor:pointer; color:#999;">Ã—</button>
        </div>

        <form th:action="@{/vendor/product/add}" method="post" enctype="multipart/form-data" id="addProductForm">
            <div style="padding:24px;">

                <div class="form-group" style="margin-bottom:16px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Product Name</label>
                    <input type="text" name="name" required placeholder="e.g., iPhone 15 Pro"
                           style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                </div>

                <div class="form-group" style="margin-bottom:16px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Description</label>
                    <textarea name="description" rows="4" placeholder="Write a detailed description..."
                              style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px; resize:vertical;"></textarea>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px;">
                    <div class="form-group">
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Price (so'm)</label>
                        <input type="number" name="price" step="0.01" min="0.01" required placeholder="99.99"
                               style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                    </div>
                    <div class="form-group">
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Stock Quantity</label>
                        <input type="number" name="stockQuantity" min="1" required placeholder="50"
                               style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                    </div>
                </div>

                <!-- Category Selection -->
                <div class="form-group" style="margin-bottom:16px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Category</label>
                    <select name="categoryId" id="categorySelect" required onchange="loadSubCategories()"
                            style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                        <option value="">Select category</option>
                        <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
                    </select>
                </div>

                <div class="form-group" style="margin-bottom:16px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Sub Category</label>
                    <select name="subCategoryId" id="subCategorySelect" required onchange="loadSubSubCategories()"
                            style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                        <option value="">Select sub category</option>
                    </select>
                </div>

                <div class="form-group" style="margin-bottom:20px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">Sub-Sub Category</label>
                    <select name="subSubCategoryId" id="subSubCategorySelect" required
                            style="width:100%; padding:12px 16px; border:1px solid #ddd; border-radius:8px; font-size:15px;">
                        <option value="">Select sub-sub category</option>
                    </select>
                </div>

                <!-- Image Upload (Max 6) -->
                <div class="form-group" style="margin-bottom:20px;">
                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#333;">
                        Product Images (up to 6)
                        <span style="font-weight:normal; color:#666; font-size:13px;"> - First image will be main</span>
                    </label>
                    <input type="file" name="image" id="imageInput" accept="image/*"
                           multiple onchange="previewImages(this)">
                    <button type="button" onclick="document.getElementById('imageInput').click()"
                            style="padding:12px 20px; background:#f1f5f9; border:2px dashed #ccc; border-radius:8px; width:100%; cursor:pointer; font-size:15px; color:#666;">
                        Click to upload images
                    </button>

                    <div id="imagePreview" style="display:grid; grid-template-columns:repeat(6,1fr); gap:12px; margin-top:16px;">
                        <!-- Previews will appear here -->
                    </div>
                    <small style="color:#ef4444; display:none;" id="imageError">You can upload maximum 6 images!</small>
                </div>

                <div style="display:flex; gap:12px; justify-content:flex-end;">
                    <button type="button" onclick="closeModal()"
                            style="padding:12px 24px; background:#f1f5f9; border:none; border-radius:8px; cursor:pointer; font-weight:600;">
                        Cancel
                    </button>
                    <button type="submit"
                            style="padding:12px 32px; background:#6c3ef0; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600;">
                        Add Product
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // ðŸ”¥ EDIT MODAL FUNCTIONS
    let currentEditProduct = null;

    function openEditModal(button) {
        // Get product data from button attributes
        currentEditProduct = {
            id: button.getAttribute('data-id'),
            name: button.getAttribute('data-name'),
            price: parseFloat(button.getAttribute('data-price')),
            stock: parseInt(button.getAttribute('data-stock')),
            image: button.getAttribute('data-image'),
            category: button.getAttribute('data-category')
        };

        // âœ… SET FORM ACTION DYNAMICALLY
        document.getElementById('editProductForm').action = `/vendor/product/edit/${currentEditProduct.id}`;
        // Fill form fields (rest stays the same)
        document.getElementById('editProductId').value = currentEditProduct.id;
        document.getElementById('editProductName').textContent = currentEditProduct.name;
        document.getElementById('editProductImage').src = currentEditProduct.image;
        document.getElementById('editProductCategory').textContent = currentEditProduct.category || 'No category';
        document.getElementById('editProductCurrentStock').innerHTML =
            `<strong>Current stock:</strong> ${currentEditProduct.stock} items`;

        document.getElementById('editPrice').value = currentEditProduct.price;
        document.getElementById('editStockQuantity').value = '';

        // Show modal
        document.getElementById("editProductModal").style.display = "flex";
        document.body.style.overflow = "hidden";
    }

    function closeEditModal() {
        document.getElementById("editProductModal").style.display = "none";
        document.body.style.overflow = "auto";
        // Clear form
        document.getElementById("editProductForm").reset();
        currentEditProduct = null;
    }

    // Update form action URL when product ID is set
    document.getElementById('editProductForm').addEventListener('submit', function() {
        const productId = document.getElementById('editProductId').value;
        if (productId) {
            this.action = `/vendor/product/edit/${productId}`;
        }
    });


    function openModal() {
        document.getElementById("addProductModal").style.display = "flex";
        document.body.style.overflow = "hidden";
    }

    function closeModal() {
        document.getElementById("addProductModal").style.display = "none";
        document.body.style.overflow = "auto";
        // Reset form
        document.getElementById("addProductForm").reset();
        document.getElementById("imagePreview").innerHTML = "";
        document.getElementById("categorySelect").value = "";
        document.getElementById("subCategorySelect").innerHTML = "<option value=''>Select sub category</option>";
        document.getElementById("subSubCategorySelect").innerHTML = "<option value=''>Select sub-sub category</option>";
    }

    let selectedImages = [];

    // Convert array â†’ FileList
    function toFileList(filesArray) {
        const dt = new DataTransfer();
        filesArray.forEach(file => dt.items.add(file));
        return dt.files;
    }

    function previewImages(input) {
        const files = Array.from(input.files);

        // Add new files to our array
        for (let file of files) {
            if (selectedImages.length >= 6) {
                document.getElementById("imageError").style.display = "block";
                return;
            }
            selectedImages.push(file);
        }

        // Update actual input
        input.files = toFileList(selectedImages);

        renderPreview();
    }

    function renderPreview() {
        const container = document.getElementById("imagePreview");
        container.innerHTML = "";

        selectedImages.forEach((file, index) => {
            const div = document.createElement("div");
            div.style.position = "relative";

            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.style.width = "100%";
            img.style.height = "90px";
            img.style.objectFit = "cover";
            img.style.borderRadius = "8px";

            const btn = document.createElement("button");
            btn.innerText = "Ã—";
            btn.style.position = "absolute";
            btn.style.top = "4px";
            btn.style.right = "4px";
            btn.style.background = "#ef4444";
            btn.style.color = "white";
            btn.style.border = "none";
            btn.style.width = "20px";
            btn.style.height = "20px";
            btn.style.borderRadius = "50%";
            btn.style.cursor = "pointer";

            btn.onclick = () => {
                selectedImages.splice(index, 1);
                document.getElementById("imageInput").files = toFileList(selectedImages);
                renderPreview();
            };

            div.appendChild(img);
            div.appendChild(btn);
            container.appendChild(div);
        });
    }

</script>

<script>
    function loadSubCategories() {
        const categoryId = document.getElementById("categorySelect").value;

        if (!categoryId) {
            document.getElementById("subCategorySelect").innerHTML =
                "<option value=''>Select sub category</option>";
            document.getElementById("subSubCategorySelect").innerHTML =
                "<option value=''>Select sub-sub category</option>";
            return;
        }

        fetch(`/vendor/api/subcategories/${categoryId}`)
            .then(res => res.json())
            .then(data => {
                const sub = document.getElementById("subCategorySelect");
                sub.innerHTML = "<option value=''>Select sub category</option>";
                data.forEach(s => {
                    sub.innerHTML += `<option value="${s.id}">${s.name}</option>`;
                });

                document.getElementById("subSubCategorySelect").innerHTML =
                    "<option value=''>Select sub-sub category</option>";
            });
    }


    function loadSubSubCategories() {
        const subId = document.getElementById("subCategorySelect").value;

        if (!subId) {
            document.getElementById("subSubCategorySelect").innerHTML =
                "<option value=''>Select sub-sub category</option>";
            return;
        }

        fetch(`/vendor/api/subsubcategories/${subId}`)
            .then(res => res.json())
            .then(data => {
                const subsub = document.getElementById("subSubCategorySelect");
                subsub.innerHTML = "<option value=''>Select sub-sub category</option>";
                data.forEach(s => {
                    subsub.innerHTML += `<option value="${s.id}">${s.name}</option>`;
                });
            });
    }
</script>

<script>
    // Search
    function filterProducts() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.querySelectorAll('tbody tr');
        rows.forEach(row => {
            const name = row.querySelector('.product-name').textContent.toLowerCase();
            row.style.display = name.includes(query) ? '' : 'none';
        });
    }
    // WebSocket (optional)
    const socket = new WebSocket('ws://' + location.host + '/ws/vendor-updates');
    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        showToast(`${data.action}: "${data.shopName}"`, 'success');
    };

    function showToast(msg, type = 'success') {
        const toast = document.createElement('div');
        toast.textContent = msg;
        toast.style.position = 'fixed';
        toast.style.bottom = '20px';
        toast.style.right = '20px';
        toast.style.padding = '12px 20px';
        toast.style.borderRadius = '8px';
        toast.style.color = '#fff';
        toast.style.fontWeight = '600';
        toast.style.zIndex = '1000';
        toast.style.background = type === 'success' ? '#22c55e' : '#ef4444';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }
</script>



</body>
</html>